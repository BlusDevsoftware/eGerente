<!-- ========================================
     MODAIS DE EXCLUSÃO E CANCELAMENTO DE BAIXA
     Sistema de Movimento de Comissões
     ======================================== -->

<!-- Modal de Confirmação de Exclusão -->
<div id="modalConfirmExclusao" class="modal" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.18); z-index: 4000; align-items: center; justify-content: center;">
  <div class="modal-content" style="background: #fff; border-radius: 16px; max-width: 520px; width: 98%; box-shadow: 0 8px 32px rgba(33,150,243,0.13); padding: 0;">
    <div class="modal-header" style="padding: 28px 40px 0 40px; display: flex; align-items: center; justify-content: space-between;">
      <h2 style="margin: 0; font-size: 1.35em; color: #e53935; display: flex; align-items: center; gap: 10px; font-weight: 700;"><i class="fas fa-exclamation-triangle"></i> Confirmar Exclusão</h2>
      <button class="close-modal" onclick="fecharModalConfirmExclusao()" style="background: none; border: none; font-size: 1.3em; color: #666; cursor: pointer; padding: 5px; transition: color 0.3s;">&times;</button>
    </div>
    <div class="modal-body" style="padding: 32px 40px 0 40px; text-align: center;">
      <i class="fas fa-exclamation-triangle" style="font-size: 2.5em; color: #e53935; margin-bottom: 12px;"></i>
      <div style="font-size: 1.15em; font-weight: 500; margin-bottom: 8px;">Tem certeza que deseja excluir este título?</div>
      <div style="font-size: 1em; color: #888; margin-bottom: 18px;">Esta ação não pode ser desfeita.</div>
      
      <!-- Informações do título -->
      <div style="background: #fff3e0; border: 1px solid #ffcc02; border-radius: 8px; padding: 16px; margin-bottom: 18px; text-align: left;">
        <div style="margin-bottom: 8px;"><strong>Número:</strong> <span id="numeroTituloExclusao"></span></div>
        <div style="margin-bottom: 8px;"><strong>Colaborador:</strong> <span id="colaboradorTituloExclusao"></span></div>
        <div style="margin-bottom: 8px;"><strong>Valor:</strong> <span id="valorTituloExclusao"></span></div>
        <div><strong>Status:</strong> <span id="statusTituloExclusao"></span></div>
      </div>
      
      <!-- Opções de exclusão para parcelamentos -->
      <div id="opcoesExclusaoParcelamento" style="display: none; background: #f5f5f5; border-radius: 8px; padding: 16px; margin-bottom: 18px; text-align: left;">
        <div style="font-weight: 500; margin-bottom: 12px; color: #333;">Opções de exclusão:</div>
        <label style="display: flex; align-items: center; margin-bottom: 8px; cursor: pointer;">
          <input type="radio" name="exclusaoParcelamento" value="unico" checked style="margin-right: 8px;">
          <span>Excluir apenas este título</span>
        </label>
        <label style="display: flex; align-items: center; cursor: pointer;">
          <input type="radio" name="exclusaoParcelamento" value="todos" style="margin-right: 8px;">
          <span>Excluir todos os títulos do parcelamento</span>
        </label>
      </div>
      
      <!-- Lista de títulos parciais -->
      <div id="listaTitulosParciais" style="display: none; background: #f8f9fa; border-radius: 8px; padding: 12px; margin-bottom: 18px; text-align: left;">
        <div style="font-weight: 500; margin-bottom: 8px; color: #333;">Títulos relacionados:</div>
        <div id="titulosParciaisLista" style="max-height: 100px; overflow-y: auto; font-size: 0.9em;"></div>
      </div>
      
      <!-- Animação de exclusão -->
      <div id="animacaoExclusaoDiv" style="display: none; margin-bottom: 18px;">
        <div style="font-weight: 500; margin-bottom: 12px; color: #1976D2;">
          <i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i>
          Excluindo título...
        </div>
        <div style="width: 100%; background-color: #e3f2fd; border-radius: 8px; height: 8px; overflow: hidden;">
          <div id="barraProgressoExclusao" style="width: 0%; height: 100%; background-color: #1976D2; border-radius: 8px; transition: width 0.3s ease;"></div>
        </div>
        <div id="textoProgressoExclusao" style="font-size: 0.9em; color: #666; margin-top: 8px;">Iniciando exclusão...</div>
      </div>
    </div>
    <div class="modal-footer" id="footerExclusaoBtns" style="display: flex; justify-content: flex-end; gap: 10px; padding: 24px 40px 32px 40px; border-top: 1px solid #eee;">
      <button id="btnCancelarExclusao" class="btn-secondary" style="padding: 10px 20px; border-radius: 4px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; background-color: #fff; color: #333; border: 1px solid #ddd;"><i class="fas fa-times"></i> Cancelar</button>
      <button id="btnConfirmarExclusao" class="btn-danger" style="padding: 10px 20px; border-radius: 4px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; background-color: #e53935; color: white; border: none;"><i class="fas fa-trash"></i> Excluir</button>
    </div>
  </div>
</div>

<!-- Modal de Sucesso de Exclusão -->
<div id="modalSucessoExclusao" class="modal" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.18); z-index: 5000; align-items: center; justify-content: center;">
  <div class="modal-content" style="background: #fff; border-radius: 12px; max-width: 370px; width: 96%; box-shadow: 0 8px 32px rgba(33,150,243,0.13); padding: 0;">
    <div class="modal-header" style="padding: 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between;">
      <h2 style="margin: 0; font-size: 1.2em; color: #43a047; display: flex; align-items: center; gap: 10px; font-weight: 700;"><i class="fas fa-check-circle"></i> Título excluído com sucesso!</h2>
      <button class="close-modal" onclick="fecharModalSucessoExclusao()" style="background: none; border: none; font-size: 1.3em; color: #666; cursor: pointer; padding: 5px; transition: color 0.3s;">&times;</button>
    </div>
    <div class="modal-body" style="padding: 24px 32px 0 32px; text-align: center;">
      <i class="fas fa-check-circle" style="font-size: 2.5em; color: #43a047; margin-bottom: 12px;"></i>
      <div style="font-size: 1.1em; font-weight: 500; margin-bottom: 8px;">O título foi removido do sistema.</div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: center; gap: 10px; padding: 18px 32px 24px 32px; border-top: 1px solid #eee;">
      <button id="btnOkSucessoExclusao" class="btn-success" style="padding: 10px 32px; border-radius: 4px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; background-color: #43a047; color: white; border: none;"><i class="fas fa-check"></i> OK</button>
    </div>
  </div>
</div>

<!-- Modal de Confirmação de Cancelar Baixa -->
<div id="modalConfirmCancelarBaixa" class="modal" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.18); z-index: 3000; align-items: center; justify-content: center;">
  <div class="modal-content" style="background: #fff; border-radius: 16px; max-width: 480px; width: 98%; box-shadow: 0 8px 32px rgba(255,152,0,0.13); padding: 0;">
    <div class="modal-header" style="padding: 28px 40px 0 40px; display: flex; align-items: center; justify-content: space-between;">
      <h2 style="margin: 0; font-size: 1.35em; color: #ff9800; display: flex; align-items: center; gap: 10px; font-weight: 700;"><i class="fas fa-exclamation-triangle"></i> Confirmar Cancelamento de Baixa</h2>
      <button class="close-modal" onclick="fecharModalConfirmCancelarBaixa()" style="background: none; border: none; font-size: 1.3em; color: #666; cursor: pointer; padding: 5px; transition: color 0.3s;">&times;</button>
    </div>
    <div class="modal-body" style="padding: 32px 40px 0 40px; text-align: center;">
      <i class="fas fa-undo" style="font-size: 2.5em; color: #ff9800; margin-bottom: 12px;"></i>
      <div style="font-size: 1.15em; font-weight: 500; margin-bottom: 8px;">Tem certeza que deseja cancelar a baixa deste título?</div>
      <div style="font-size: 1em; color: #888; margin-bottom: 18px;">Esta ação irá:</div>
      <div style="text-align: left; background: #fff3e0; border: 1px solid #ffcc02; border-radius: 8px; padding: 16px; margin-bottom: 18px;">
        <ul style="margin: 0; padding-left: 20px; color: #e65100;">
          <li>Alterar o status para "PENDENTE"</li>
          <li>Zerar o valor pago</li>
          <li>Limpar a data de pagamento</li>
          <li>Remover o comprovante (se existir)</li>
        </ul>
      </div>
      <div style="font-size: 0.95em; color: #666; font-style: italic;">Esta ação pode ser desfeita editando o título novamente.</div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: flex-end; gap: 10px; padding: 24px 40px 32px 40px; border-top: 1px solid #eee;">
      <button id="btnCancelarConfirmacao" class="btn-secondary" onclick="fecharModalConfirmCancelarBaixa()" style="padding: 10px 20px; border-radius: 4px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; background-color: #fff; color: #333; border: 1px solid #ddd;"><i class="fas fa-times"></i> Cancelar</button>
      <button id="btnConfirmarCancelarBaixa" class="btn-warning" onclick="executarCancelarBaixa()" style="padding: 10px 20px; border-radius: 4px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; background-color: #ff9800; color: white; border: none;"><i class="fas fa-undo"></i> Confirmar Cancelamento</button>
    </div>
  </div>
</div>

<!-- Modal de Sucesso de Cancelamento de Baixa -->
<div id="modalSucessoCancelarBaixa" class="modal" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.18); z-index: 3000; align-items: center; justify-content: center;">
  <div class="modal-content" style="background: #fff; border-radius: 12px; max-width: 400px; width: 96%; box-shadow: 0 8px 32px rgba(255,152,0,0.13); padding: 0;">
    <div class="modal-header" style="padding: 20px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: space-between;">
      <h2 style="margin: 0; font-size: 1.2em; color: #ff9800; display: flex; align-items: center; gap: 10px; font-weight: 700;"><i class="fas fa-check-circle"></i> Baixa cancelada com sucesso!</h2>
      <button class="close-modal" onclick="fecharModalSucessoCancelarBaixa()" style="background: none; border: none; font-size: 1.3em; color: #666; cursor: pointer; padding: 5px; transition: color 0.3s;">&times;</button>
    </div>
    <div class="modal-body" style="padding: 24px 32px 0 32px; text-align: center;">
      <i class="fas fa-undo" style="font-size: 2.5em; color: #ff9800; margin-bottom: 12px;"></i>
      <div style="font-size: 1.1em; font-weight: 500; margin-bottom: 8px;">A baixa do título foi cancelada.</div>
      <div style="font-size: 0.95em; color: #666; margin-bottom: 8px;">O título agora está com status "PENDENTE".</div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: center; gap: 10px; padding: 18px 32px 24px 32px; border-top: 1px solid #eee;">
      <button id="btnOkSucessoCancelarBaixa" class="btn-warning" style="padding: 10px 32px; border-radius: 4px; font-size: 15px; font-weight: 500; cursor: pointer; display: flex; align-items: center; gap: 8px; background-color: #ff9800; color: white; border: none;"><i class="fas fa-check"></i> OK</button>
    </div>
  </div>
</div>

<!-- Modal de Título Pago Não Pode Excluir -->
<div id="modalTituloPagoNaoPodeExcluir" class="modal" style="display:none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.18); z-index: 4000; align-items: center; justify-content: center;">
  <div class="modal-content" style="background: #fff; border-radius: 16px; max-width: 480px; width: 96%; box-shadow: 0 8px 32px rgba(255,152,0,0.13); padding: 0;">
    <div class="modal-header" style="padding: 28px 40px 0 40px; display: flex; align-items: center; justify-content: space-between;">
      <h2 style="margin: 0; font-size: 1.35em; color: #4CAF50; display: flex; align-items: center; gap: 10px; font-weight: 700;"><i class="fas fa-check-circle"></i> Título Já Pago</h2>
      <button class="close-modal" onclick="fecharModalTituloPagoNaoPodeExcluir()" style="background: none; border: none; font-size: 1.3em; color: #666; cursor: pointer; padding: 5px; transition: color 0.3s;">&times;</button>
    </div>
    <div class="modal-body" style="padding: 32px 40px 0 40px; text-align: center;">
      <div style="background: #e8f5e8; border-radius: 50%; width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px auto;">
        <i class="fas fa-check-circle" style="font-size: 2.5em; color: #4CAF50;"></i>
      </div>
      
      <div style="font-size: 1.2em; font-weight: 600; margin-bottom: 8px; color: #333;">Este título já foi pago!</div>
      <div style="font-size: 1em; color: #666; margin-bottom: 24px;">
        O título <strong id="numeroTituloPago" style="color: #1976D2;"></strong> já possui status <strong style="color: #4CAF50;">PAGO</strong> e não pode ser excluído.
      </div>
      
      <!-- Informações detalhadas do título -->
      <div style="background: #f8f9fa; border: 1px solid #e9ecef; border-radius: 12px; padding: 20px; margin-bottom: 24px; text-align: left;">
        <div style="font-weight: 600; color: #333; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
          <i class="fas fa-info-circle" style="color: #1976D2;"></i>
          Detalhes do Pagamento
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 0.95em;">
          <div style="background: #fff; padding: 12px; border-radius: 8px; border: 1px solid #e3f2fd;">
            <div style="font-weight: 500; color: #1976D2; margin-bottom: 4px;">Data do Pagamento</div>
            <div id="dataPagamentoTitulo" style="color: #333; font-weight: 600;"></div>
          </div>
          
          <div style="background: #fff; padding: 12px; border-radius: 8px; border: 1px solid #e3f2fd;">
            <div style="font-weight: 500; color: #1976D2; margin-bottom: 4px;">Valor Pago</div>
            <div id="valorPagoTitulo" style="color: #333; font-weight: 600;"></div>
          </div>
          
          <div style="background: #fff; padding: 12px; border-radius: 8px; border: 1px solid #e3f2fd;">
            <div style="font-weight: 500; color: #1976D2; margin-bottom: 4px;">Colaborador</div>
            <div id="colaboradorTituloPago" style="color: #333; font-weight: 600;"></div>
          </div>
          
          <div style="background: #fff; padding: 12px; border-radius: 8px; border: 1px solid #e3f2fd;">
            <div style="font-weight: 500; color: #1976D2; margin-bottom: 4px;">Status</div>
            <div style="color: #4CAF50; font-weight: 600; display: flex; align-items: center; gap: 6px;">
              <i class="fas fa-check-circle"></i>
              PAGO
            </div>
          </div>
        </div>
        
        <div id="observacoesTitulo" style="display: none; margin-top: 12px;">
          <div style="background: #fff; padding: 12px; border-radius: 8px; border: 1px solid #e3f2fd;">
            <div style="font-weight: 500; color: #1976D2; margin-bottom: 4px;">Observações</div>
            <div id="textoObservacoesTitulo" style="color: #333; font-style: italic;"></div>
          </div>
        </div>
      </div>
      
      <!-- Aviso sobre como proceder -->
      <div style="background: #fff3e0; border: 1px solid #ffcc02; border-radius: 12px; padding: 16px; margin-bottom: 24px;">
        <div style="display: flex; align-items: flex-start; gap: 12px;">
          <i class="fas fa-lightbulb" style="color: #ff9800; font-size: 1.2em; margin-top: 2px;"></i>
          <div style="text-align: left;">
            <div style="font-weight: 600; color: #e65100; margin-bottom: 6px;">Como proceder?</div>
            <div style="font-size: 0.95em; color: #e65100;">
              Para excluir este título, você deve primeiro <strong>cancelar a baixa</strong> através da opção "Cancelar Baixa" no menu de ações do título.
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-footer" style="display: flex; justify-content: center; gap: 12px; padding: 24px 40px 32px 40px; border-top: 1px solid #eee;">
      <button class="btn-secondary" onclick="fecharModalTituloPagoNaoPodeExcluir()" style="padding: 12px 28px; border-radius: 8px; font-size: 15px; font-weight: 500; cursor: pointer; background-color: #f5f5f5; color: #333; border: 1px solid #ddd; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease;">
        <i class="fas fa-times"></i>
        Entendi
      </button>
    </div>
  </div>
</div>

<!-- ========================================
     JAVASCRIPT DOS MODAIS
     ======================================== -->

<script>
// Variáveis globais para os modais
let tituloParaExcluir = null;
let tituloParaCancelarBaixa = null;
let modoExclusaoParcelamento = 'unico';
let titulosParaExcluirAnimacao = [];

// ========================================
// FUNÇÕES DE EXCLUSÃO
// ========================================

// Função para confirmar exclusão de título
async function confirmarExclusao(modo) {
  if (!tituloParaExcluir || !tituloParaExcluir.titulo) {
    console.error('Nenhum título para excluir');
    return;
  }
  
  const titulo = tituloParaExcluir.titulo;
  console.log('Executando exclusão do título:', titulo.numero_titulo, 'modo:', modo);
  
  // Mostrar animação de exclusão
  const animacaoDiv = document.getElementById('animacaoExclusaoDiv');
  const footerBtns = document.getElementById('footerExclusaoBtns');
  const barraProgresso = document.getElementById('barraProgressoExclusao');
  const textoProgresso = document.getElementById('textoProgressoExclusao');
  
  if (animacaoDiv) animacaoDiv.style.display = 'block';
  if (footerBtns) footerBtns.style.display = 'none';
  if (barraProgresso) barraProgresso.style.width = '0%';
  if (textoProgresso) textoProgresso.textContent = 'Iniciando exclusão...';
  
  try {
    if (modo === 'unico') {
      // Excluir apenas o título atual
      console.log('Excluindo título único:', titulo.id);
      
      // Atualizar progresso
      if (barraProgresso) barraProgresso.style.width = '50%';
      if (textoProgresso) textoProgresso.textContent = 'Excluindo título...';
      
      await window.api.delete(`/movimento_comissoes/${titulo.id}`);
      
      // Atualizar progresso
      if (barraProgresso) barraProgresso.style.width = '100%';
      if (textoProgresso) textoProgresso.textContent = 'Título excluído com sucesso!';
      
      // Aguardar um pouco para mostrar o progresso completo
      await new Promise(resolve => setTimeout(resolve, 500));
      
      // Atualizar arrays locais
      todosTitulos = todosTitulos.filter(t => t.id !== titulo.id);
      titulosFiltrados = titulosFiltrados.filter(t => t.id !== titulo.id);
      
      // Atualizar interface
      atualizarTabelaComFiltros();
      atualizarCardsTotalizadores();
      
      fecharModalConfirmExclusao();
      abrirModalSucessoExclusao();
      
    } else if (modo === 'todos') {
      // Excluir todos os títulos do parcelamento
      const prefixo = (titulo.numero_titulo || '').split('-')[0];
      const titulosDoGrupo = todosTitulos.filter(t => (t.numero_titulo || '').startsWith(prefixo + '-'));
      
      console.log('Excluindo parcelamento completo:', titulosDoGrupo.length, 'títulos');
      
      // Calcular progresso por título
      const progressoPorTitulo = 100 / titulosDoGrupo.length;
      
      for (let i = 0; i < titulosDoGrupo.length; i++) {
        const t = titulosDoGrupo[i];
        
        // Atualizar progresso
        const progressoAtual = (i + 1) * progressoPorTitulo;
        if (barraProgresso) barraProgresso.style.width = progressoAtual + '%';
        if (textoProgresso) textoProgresso.textContent = `Excluindo título ${i + 1} de ${titulosDoGrupo.length}...`;
        
        await window.api.delete(`/movimento_comissoes/${t.id}`);
        
        // Pequeno delay para mostrar o progresso
        await new Promise(resolve => setTimeout(resolve, 200));
      }
      
      if (textoProgresso) textoProgresso.textContent = 'Todos os títulos excluídos com sucesso!';
      
      // Aguardar um pouco para mostrar o progresso completo
      await new Promise(resolve => setTimeout(resolve, 500));
      
      todosTitulos = todosTitulos.filter(t => !(t.numero_titulo || '').startsWith(prefixo + '-'));
      titulosFiltrados = titulosFiltrados.filter(t => !(t.numero_titulo || '').startsWith(prefixo + '-'));
      
      atualizarTabelaComFiltros();
      atualizarCardsTotalizadores();
      
      fecharModalConfirmExclusao();
      abrirModalSucessoExclusao();
    }
    
  } catch (error) {
    console.error('Erro ao excluir título:', error);
    
    // Mostrar erro no progresso
    if (textoProgresso) textoProgresso.textContent = 'Erro ao excluir título!';
    if (barraProgresso) barraProgresso.style.backgroundColor = '#e53935';
    
    // Aguardar um pouco e mostrar alerta
    await new Promise(resolve => setTimeout(resolve, 1000));
    
    alert(`Erro ao excluir título: ${error.message}`);
    
    // Restaurar botões
    if (footerBtns) footerBtns.style.display = 'flex';
    if (animacaoDiv) animacaoDiv.style.display = 'none';
  }
}

function abrirModalConfirmExclusao(titulo, onConfirm) {
  console.log('abrirModalConfirmExclusao chamada com:', titulo);
  
  // Verificar se o título está com status PAGO
  if (titulo.status && titulo.status.toUpperCase() === 'PAGO') {
    console.log('Título está pago, mostrando modal de aviso...');
    mostrarModalTituloPagoNaoPodeExcluir(titulo);
    return;
  }
  
  tituloParaExcluir = { titulo, onConfirm };
  console.log('tituloParaExcluir definido como:', tituloParaExcluir);
  
  // Preencher informações do título no modal
  document.getElementById('numeroTituloExclusao').textContent = titulo.numero_titulo || '';
  document.getElementById('colaboradorTituloExclusao').textContent = mapaColaboradores[titulo.colaborador_id] || titulo.colaborador_id || '';
  document.getElementById('valorTituloExclusao').textContent = formatarValorLocal(titulo.valor);
  document.getElementById('statusTituloExclusao').textContent = titulo.status || '';
  
  // Detecta se é parcelado pelo padrão do número do título
  const match = (titulo.numero_titulo || '').match(/^(\d+)-\d+\/\d+$/);
  const opcoesDiv = document.getElementById('opcoesExclusaoParcelamento');
  if (match && opcoesDiv) {
    console.log('Título é parcelado, mostrando opções...');
    opcoesDiv.style.display = 'block';
    const radioUnico = document.querySelector('input[name="exclusaoParcelamento"][value="unico"]');
    if (radioUnico) radioUnico.checked = true;
    modoExclusaoParcelamento = 'unico';
  } else if (opcoesDiv) {
    console.log('Título não é parcelado, ocultando opções...');
    opcoesDiv.style.display = 'none';
    modoExclusaoParcelamento = 'unico';
  }
  
  document.getElementsByName('exclusaoParcelamento').forEach(radio => {
    radio.onchange = function() {
      modoExclusaoParcelamento = this.value;
      console.log('Modo de exclusão alterado para:', modoExclusaoParcelamento);
    };
  });
  
  // Verificar e configurar elementos com segurança
  const confirmacaoDiv = document.getElementById('confirmacaoExclusaoDiv');
  if (confirmacaoDiv) confirmacaoDiv.style.display = 'none';
  
  const animacaoDiv = document.getElementById('animacaoExclusaoDiv');
  if (animacaoDiv) animacaoDiv.style.display = 'none';
  
  const footerBtns = document.getElementById('footerExclusaoBtns');
  if (footerBtns) footerBtns.style.display = 'flex';
  
  const modal = document.getElementById('modalConfirmExclusao');
  if (modal) {
    console.log('Abrindo modal de confirmação de exclusão...');
    modal.style.display = 'flex';
  } else {
    console.error('Modal modalConfirmExclusao não encontrado!');
  }
}

function fecharModalConfirmExclusao() {
  console.log('Executando fecharModalConfirmExclusao...');
  const modal = document.getElementById('modalConfirmExclusao');
  console.log('Modal encontrado:', modal);
  if (modal) {
    console.log('Display antes de fechar:', modal.style.display);
    modal.style.display = 'none';
    console.log('Display após fechar:', modal.style.display);
    console.log('Modal de confirmação fechado com sucesso');
  } else {
    console.log('Modal de confirmação não encontrado');
  }
  
  // Resetar campos com segurança
  const confirmacaoDiv = document.getElementById('confirmacaoExclusaoDiv');
  if (confirmacaoDiv) confirmacaoDiv.style.display = 'none';
  const inputConfirmo = document.getElementById('inputConfirmoExclusao');
  if (inputConfirmo) inputConfirmo.value = '';
  const erroConfirmo = document.getElementById('erroConfirmoExclusao');
  if (erroConfirmo) erroConfirmo.style.display = 'none';
}

function abrirModalSucessoExclusao() {
  const modal = document.getElementById('modalSucessoExclusao');
  if (modal) modal.style.display = 'flex';
}

function fecharModalSucessoExclusao() {
  const modal = document.getElementById('modalSucessoExclusao');
  if (modal) modal.style.display = 'none';
}

// ========================================
// FUNÇÕES DE CANCELAMENTO DE BAIXA
// ========================================

function abrirModalConfirmCancelarBaixa(titulo) {
  tituloParaCancelarBaixa = titulo;
  
  // Verificar se há títulos parciais relacionados
  const titulosParciais = todosTitulos.filter(t => t.id_titulo_origem === tituloParaCancelarBaixa.id);
  const isBaixaParcial = titulosParciais.length > 0;
  
  // Atualizar o modal de confirmação com informações específicas
  const modalBody = document.querySelector('#modalConfirmCancelarBaixa .modal-body');
  const listaAcoes = modalBody.querySelector('ul');
  
  if (isBaixaParcial) {
    // Adicionar item sobre exclusão de títulos parciais
    const itemParciais = document.createElement('li');
    itemParciais.textContent = `Excluir ${titulosParciais.length} título(s) parcial(is) gerado(s)`;
    itemParciais.style.color = '#e65100';
    itemParciais.style.fontWeight = 'bold';
    listaAcoes.appendChild(itemParciais);
    
    // Atualizar mensagem de aviso
    const avisoDiv = modalBody.querySelector('div[style*="font-style: italic"]');
    if (avisoDiv) {
      avisoDiv.innerHTML = '<strong>Atenção:</strong> Esta ação irá excluir permanentemente os títulos parciais. Esta ação não pode ser desfeita.';
      avisoDiv.style.color = '#e53935';
      avisoDiv.style.fontWeight = 'bold';
    }
  }
  
  // Abrir modal de confirmação
  document.getElementById('modalConfirmCancelarBaixa').style.display = 'flex';
}

function fecharModalConfirmCancelarBaixa() {
  document.getElementById('modalConfirmCancelarBaixa').style.display = 'none';
  // Não resetar tituloParaCancelarBaixa aqui, pois pode ser necessário para executarCancelarBaixa
  // A variável será resetada apenas após o cancelamento ser executado com sucesso
}

function fecharModalSucessoCancelarBaixa() {
  const modal = document.getElementById('modalSucessoCancelarBaixa');
  if (modal) modal.style.display = 'none';
}

// ========================================
// FUNÇÕES AUXILIARES
// ========================================

function mostrarModalTituloPagoNaoPodeExcluir(titulo) {
  const modal = document.getElementById('modalTituloPagoNaoPodeExcluir');
  if (modal) {
    // Preencher informações do título
    document.getElementById('numeroTituloPago').textContent = titulo.numero_titulo || '';
    document.getElementById('dataPagamentoTitulo').textContent = formatarDataLocal(titulo.data_pagamento) || 'Não informada';
    document.getElementById('valorPagoTitulo').textContent = formatarValorLocal(titulo.valor_pago) || 'Não informado';
    document.getElementById('colaboradorTituloPago').textContent = mapaColaboradores[titulo.colaborador_id] || titulo.colaborador_id || '';
    
    // Mostrar observações se existirem
    const observacoesDiv = document.getElementById('observacoesTitulo');
    const observacoesTexto = document.getElementById('textoObservacoesTitulo');
    if (titulo.observacoes && titulo.observacoes.trim()) {
      observacoesTexto.textContent = titulo.observacoes;
      observacoesDiv.style.display = 'block';
    } else {
      observacoesDiv.style.display = 'none';
    }
    
    modal.style.display = 'flex';
  }
}

function fecharModalTituloPagoNaoPodeExcluir() {
  const modal = document.getElementById('modalTituloPagoNaoPodeExcluir');
  if (modal) modal.style.display = 'none';
}

// Função para fechar todos os modais relacionados ao cancelamento de baixa
function fecharTodosModaisCancelamento() {
  console.log('Fechando todos os modais de cancelamento...');
  
  // Lista de todos os modais que podem estar abertos
  const modaisParaFechar = [
    'modalConfirmCancelarBaixa',
    'modalConfirmExclusao',
    'modalTitulo',
    'modalSucessoCancelarBaixa'
  ];
  
  modaisParaFechar.forEach(modalId => {
    const modal = document.getElementById(modalId);
    if (modal && modal.style.display !== 'none') {
      console.log(`Fechando modal: ${modalId}`);
      modal.style.display = 'none';
    }
  });
  
  // Resetar variáveis globais apenas após operação completa
  // tituloParaCancelarBaixa = null; // Comentado para evitar reset prematuro
  tituloParaExcluir = null;
  
  console.log('Todos os modais de cancelamento foram fechados');
}

// ========================================
// EVENT LISTENERS
// ========================================

// Event listeners serão configurados no arquivo principal após carregamento dos modais
// Removidos para evitar duplicação e conflitos
</script> 